<!DOCTYPE html>
<html lang="en" ng-app="myApp">

<head>
  <meta charset="UTF-8">
  <title>Find Tournaments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
  <style>
    .card-img-top {
      height: 200px;
      object-fit: cover;
    }

    .banner-wrapper {
      height: 250px;
      /* or any height you want */
      width: 100%;
    }

    .object-fit-cover {
      object-fit: cover;
    }
  </style>
</head>

<body ng-controller="myCtrl">

  <div class="container mt-4">
    <h2 class="text-center text-primary mb-4">Find Tournaments</h2>

    <!-- Dropdowns -->
    <div class="row mb-4">
      <div class="col-md-5">
        <label>Select City</label>
        <select class="form-select" ng-model="selectedCity" ng-options="city for city in cityList">
          <option value="">-- Choose City --</option>
        </select>
      </div>
      <div class="col-md-5">
        <label>Select Sport</label>
        <select class="form-select" ng-model="selectedSport">
          <option value="">-- Choose Sport --</option>
          <option>Cricket</option>
          <option>Football</option>
          <option>Badminton</option>
          <option>Volleyball</option>
          <option>Basketball</option>
          <option>Chess</option>
          <option>Table Tennis</option>
          <option>Tennis</option>
          <option>Hockey</option>
          <option>Baseball</option>
          <option>Rugby</option>
          <option>Boxing</option>
          <option>Karate</option>
          <option>Swimming</option>
          <option>Skating</option>
          <option>Golf</option>
          <option>Wrestling</option>
          <option>Archery</option>
          <option>Gymnastics</option>
          <option>Squash</option>

        </select>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button class="btn btn-primary w-100" ng-click="findTournaments()">Find</button>
      </div>
    </div>

    <!-- Tournament Cards -->
    <div class="row g-4" ng-if="tournamentList.length > 0">
      <div class="col-md-4" ng-repeat="t in tournamentList">
        <div class="card shadow">
        <img ng-src="{{t.banner}}" 
     onerror="this.onerror=null;this.src='/pics/Games.jpg';" 
     class="card-img-top" 
     alt="Tournament Image">

          <div class="card-body text-center">
            <h5 class="card-title">{{t.name}}</h5>
            <p><strong>City:</strong> {{t.city}}</p>
            <p><strong>Sport:</strong> {{t.sports}}</p>
            <p><strong>Date:</strong> {{t.date | date:'dd MMM yyyy'}}</p>
            <!-- Remove these Bootstrap auto-toggle attributes -->
            <button class="btn btn-success" ng-click="showDetails(t.id)">View Details</button>

          </div>
        </div>
      </div>
    </div>

    <div class="alert alert-warning mt-4 text-center" ng-if="tournamentList.length == 0 && searched">
      No tournaments found for the selected city and sport.
    </div>
  </div>

  <!-- Tournament Details Modal -->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title w-100 text-center">{{selectedTournament.name}}</h5>

          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" ng-if="selectedTournament">
          <div class="banner-wrapper mb-3 rounded overflow-hidden">
          <img ng-src="{{selectedTournament.banner}}"
     onerror="this.onerror=null;this.src='/pics/Games.jpg';"
     class="img-fluid w-100 h-100 object-fit-cover"
     alt="Tournament Banner">

          </div>


          <table class="table table-bordered">
            <tr>
              <th>Title</th>
              <td>{{selectedTournament.name}}</td>
            </tr>
            <tr>
              <th>City</th>
              <td>{{selectedTournament.city}}</td>
            </tr>
            <tr>
              <th>Sport</th>
              <td>{{selectedTournament.sports}}</td>
            </tr>
            <tr>
              <th>Date</th>
              <td>{{selectedTournament.eventDate | date:'dd MMM yyyy'}}</td>
            </tr>
            <tr>
              <th>Time</th>
              <td>{{selectedTournament.eventTime}}</td>
            </tr>
            <tr>
              <th>Venue</th>
              <td>{{selectedTournament.address}}</td>
            </tr>
            <tr>
              <th>Min Age</th>
              <td>{{selectedTournament.minAge}}</td>
            </tr>
            <tr>
              <th>Max Age</th>
              <td>{{selectedTournament.maxAge}}</td>
            </tr>
            <tr>
              <th>Fee</th>
              <td>{{selectedTournament.fee}}</td>
            </tr>
            <tr>
              <th>Prize Money</th>
              <td>{{selectedTournament.prizeMoney}}</td>
            </tr>
            <tr>
              <th>Contact Person</th>
              <td>{{selectedTournament.contactPerson}}</td>
            </tr>
            <tr>
              <th>Email</th>
              <td>{{selectedTournament.emailid}}</td>
            </tr>
            <tr>
              <th>Post Date</th>
              <td>{{selectedTournament.postDate | date:'dd MMM yyyy'}}</td>
            </tr>
          </table>

        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    var app = angular.module("myApp", []);
    app.controller("myCtrl", function ($scope, $http) {
      $scope.cityList = [];
      $scope.tournamentList = [];
      $scope.selectedTournament = {};
      $scope.searched = false;

      // Load unique cities
      $http.get("/fetch-cities").then(res => {
        $scope.cityList = res.data;
      });

      // Search for tournaments
      $scope.findTournaments = function () {
        if (!$scope.selectedCity || !$scope.selectedSport) {
          alert("Please select both city and sport.");
          return;
        }
        const url = `/find-tournaments?city=${encodeURIComponent($scope.selectedCity)}&sport=${encodeURIComponent($scope.selectedSport)}`;
        $http.get(url).then(res => {
          $scope.tournamentList = res.data;
          $scope.searched = true;
        });
      };

      // Show tournament details in modal
      $scope.showDetails = function (id) {
        $http.get("/get-tournament-details?id=" + id).then(function (res) {
          console.log("Details fetched", res.data);
          $scope.selectedTournament = res.data;

          // Manually show the Bootstrap modal
          const modal = new bootstrap.Modal(document.getElementById('detailsModal'));
          modal.show();
        }, function (error) {
          console.error("Failed to fetch tournament details:", error);
        });
      };


    });
  </script>

</body>

</html>