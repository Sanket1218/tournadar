<!DOCTYPE html>
<html lang="en" ng-app="playerApp">
<head>
  <meta charset="UTF-8">
  <title>Player Credentials</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
  <style>
   .card-img-top {
  height: 200px;
  width: 100%;
  object-fit: contain;
  object-position: center;
}

    .player-card {
      min-height: 440px;
    }
  </style>
</head>
<body ng-controller="playerCtrl">

<div class="container my-4">
  <h2 class="text-center text-primary mb-4">Player Credentials</h2>

  <div class="text-center mb-4">
  <button class="btn btn-primary px-4" ng-click="fetchPlayers()">Fetch All</button>
</div>


  <div class="row g-4" ng-if="players.length > 0">
    <div class="col-md-4" ng-repeat="p in players">
      <div class="card shadow player-card text-center">
        <img ng-src="{{p.profile_pic || 'pics/default-profile.png'}}" class="card-img-top" alt="Profile Image">
        <div class="card-body">
          <h5 class="card-title">{{p.name}}</h5>
          <p><strong>Email:</strong> {{p.emailid}}</p>
          <p><strong>Games:</strong> {{p.games_you_play}}</p>
          <button class="btn btn-info me-2" ng-click="viewDetails(p)">Details</button>
          <button class="btn btn-danger" ng-click="deletePlayer(p.emailid)">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <div class="alert alert-warning text-center mt-4" ng-if="players.length === 0 && fetchedOnce">
    No player profiles found.
  </div>
</div>

<!-- Player Details Modal -->
<div class="modal fade" id="playerDetailsModal" tabindex="-1" aria-labelledby="playerDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Player Details - {{selectedPlayer.name}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" ng-if="selectedPlayer">
        <img ng-src="{{selectedPlayer.aadhar_pic || 'pics/no-aadhar.png'}}" class="img-fluid rounded mb-3" alt="Aadhar Image">

        <table class="table table-bordered">
          <tr><th>Name</th><td>{{selectedPlayer.name}}</td></tr>
          <tr><th>Email</th><td>{{selectedPlayer.emailid}}</td></tr>
          <tr><th>DOB</th><td>{{selectedPlayer.dob | date:'dd MMM yyyy'}}</td></tr>
          <tr><th>Gender</th><td>{{selectedPlayer.gender}}</td></tr>
          <tr><th>Address</th><td>{{selectedPlayer.address}}</td></tr>
          <tr><th>Contact</th><td>{{selectedPlayer.contact}}</td></tr>
          <tr><th>Games</th><td>{{selectedPlayer.games_you_play}}</td></tr>
          <tr><th>Other Info</th><td>{{selectedPlayer.other_info}}</td></tr>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

<script>
  var app = angular.module("playerApp", []);
  app.controller("playerCtrl", function ($scope, $http) {
    $scope.players = [];
    $scope.selectedPlayer = {};
    $scope.fetchedOnce = false;

    $scope.fetchPlayers = function () {
      $http.get("/fetch-all-players").then(function (res) {
        $scope.players = res.data;
        $scope.fetchedOnce = true;
      }, function (err) {
        console.error("Error:", err);
        alert("Failed to fetch players.");
      });
    };

    $scope.viewDetails = function (player) {
      $scope.selectedPlayer = player;
      const modal = new bootstrap.Modal(document.getElementById('playerDetailsModal'));
      modal.show();
    };

    $scope.deletePlayer = function (emailid) {
      if (!confirm("Are you sure you want to delete this player?")) return;

      $http.get("/delete-player?emailid=" + encodeURIComponent(emailid)).then(
        function (res) {
          alert(res.data);
          $scope.fetchPlayers(); // refresh the list
        },
        function (err) {
          console.error("Delete error:", err);
          alert("Failed to delete player.");
        }
      );
    };
  });
</script>

</body>
</html>
